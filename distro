#!/bin/sh
# Returns tab deliminated output for OS/Kernel/Arch/Distro/Version

getkernel() {
	if [ "${OS}" == "AIX" ]; then
		export KERNEL=$(oslevel)
	else
		export KERNEL=$(uname -r)
	fi
}

getdistro() {
	if [ "${OS}" == "Linux" ]; then
		if [ -f /etc/redhat-release ]; then
			DISTRO=$(cat /etc/redhat-release | awk '{print $1}')
		elif [ -f /etc/mandriva-release ]; then
			DISTRO="Mandriva"
		elif [ -f /etc/arch-release ]; then
			DISTRO="ArchLinux"
		elif [ -f /etc/SuSE-release ]; then
			DISTRO="SuSE"
		elif [ -f /etc/mandrake-release ] ; then
			DISTRO="Mandrake"
		elif [ -f /etc/debian_version ] ; then
			# shit based on debian
			if [ -f /etc/mailcleaner/etc/mailcleaner/version.def ]; then
				DISTRO="MailCleaner"
			else
				DISTRO="Debian"
			fi
		elif [ -f /etc/UnitedLinux-release ] ; then
			DISTRO="UnitedLinux"
		elif [ -f /etc/lsb-release ] ; then
			LSB_DIST="`cat /etc/lsb-release | grep DISTRIB_ID | cut -d "=" -f2`"
			LSB_REV="`cat /etc/lsb-release | grep DISTRIB_RELEASE | cut -d "=" -f2`"
			if [ "$LSB_DIST" != "" ] ; then
				DISTRO=$LSB_DIST
			fi
		fi
	elif [ "${OS}" == "FreeBSD" ]; then
		if [ -f /etc/platform -o -f /etc/version ]; then
			DISTRO="pfSense"
		fi
	fi
	export DISTRO
}

getarch() {
	export ARCH=$(uname -m)
}

getversion() {
	# basically a no-op
	if [ "${OS}" == "AIX" ]; then
		export VERSION=$(oslevel -r)
	elif [ "${OS}" == "FreeBSD" ]; then
		if [ "${DISTRO}" == "pfSense" ]; then
			export VERSION=$(cat /etc/version)
		fi
	else
		return
	fi
}

case $(uname -s) in
	Linux)
		OS="Linux"
		getkernel
		getarch
		getdistro
		;;
	SunOS)
		OS="Solaris"
		getkernel
		getarch
		getdistro
		getversion
		;;
	FreeBSD)
		OS="FreeBSD"
		getkernel
		getarch
		getdistro
		getversion
		;;
	AIX)
		OS="AIX"
		getkernel
		getversion
		;;
	*)
		# No idea what it is, kill them with fire
		echo "NOPE NOPE NOPE"
esac

echo "${OS}|${KERNEL}|${ARCH}|${DISTRO}|${VERSION}"
